<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Avoqado SDK - Ejemplo de Integraci√≥n</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: #f5f5f5;
        padding: 40px 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      .header {
        background: white;
        padding: 40px;
        border-radius: 12px;
        margin-bottom: 30px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      h1 {
        color: #333;
        margin-bottom: 10px;
      }

      .subtitle {
        color: #666;
        font-size: 16px;
      }

      .demo-section {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-bottom: 30px;
      }

      .card {
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .card h2 {
        color: #333;
        margin-bottom: 20px;
        font-size: 20px;
      }

      .payment-form {
        margin-bottom: 20px;
      }

      .form-group {
        margin-bottom: 15px;
      }

      label {
        display: block;
        margin-bottom: 5px;
        color: #555;
        font-weight: 500;
      }

      input,
      select {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 14px;
      }

      button {
        width: 100%;
        padding: 14px;
        background: #4caf50;
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s;
      }

      button:hover {
        background: #45a049;
      }

      button:disabled {
        background: #ccc;
        cursor: not-allowed;
      }

      #payment-container {
        min-height: 600px;
        border: 2px dashed #ddd;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #999;
      }

      #payment-container.loaded {
        border: none;
      }

      .code-section {
        grid-column: 1 / -1;
      }

      pre {
        background: #2d2d2d;
        color: #f8f8f2;
        padding: 20px;
        border-radius: 8px;
        overflow-x: auto;
        font-size: 14px;
        line-height: 1.5;
      }

      .status {
        padding: 15px;
        border-radius: 6px;
        margin-top: 20px;
        display: none;
      }

      .status.success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
        display: block;
      }

      .status.error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
        display: block;
      }

      .tag {
        display: inline-block;
        padding: 4px 8px;
        background: #e3f2fd;
        color: #1976d2;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 500;
        margin-bottom: 10px;
      }

      @media (max-width: 768px) {
        .demo-section {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <div class="header">
        <h1>ü•ë Avoqado Payment SDK</h1>
        <p class="subtitle">Integraci√≥n de checkout embebido con tokenizaci√≥n segura (SAQ A compliant)</p>
      </div>

      <!-- Demo Section -->
      <div class="demo-section">
        <!-- Configuration Panel -->
        <div class="card">
          <h2>‚öôÔ∏è Configuraci√≥n</h2>

          <div class="form-group">
            <label for="session-id">Session ID</label>
            <input type="text" id="session-id" value="cs_avoqado_demo_123456" placeholder="cs_avoqado_xxxxx" />
          </div>

          <div class="form-group">
            <label for="amount">Monto (MXN)</label>
            <input type="number" id="amount" value="100.00" step="0.01" min="1" />
          </div>

          <div class="form-group">
            <label for="currency">Moneda</label>
            <select id="currency">
              <option value="MXN">MXN - Peso Mexicano</option>
              <option value="USD">USD - D√≥lar</option>
            </select>
          </div>

          <div class="form-group">
            <label for="locale">Idioma</label>
            <select id="locale">
              <option value="es-MX">Espa√±ol (M√©xico)</option>
              <option value="en-US">English (US)</option>
            </select>
          </div>

          <button id="init-checkout">Inicializar Checkout</button>

          <button id="update-amount" style="margin-top: 10px; background: #2196f3">Actualizar Monto</button>

          <button id="destroy-checkout" style="margin-top: 10px; background: #f44336">Destruir Checkout</button>

          <div id="status-message"></div>
        </div>

        <!-- Checkout Preview -->
        <div class="card">
          <div class="tag">DEMO EN VIVO</div>
          <h2>üí≥ Checkout Preview</h2>
          <div id="payment-container"></div>
        </div>
      </div>

      <!-- Code Examples -->
      <div class="demo-section code-section">
        <div class="card">
          <h2>üìù C√≥digo de Integraci√≥n</h2>

          <h3 style="margin-top: 20px; color: #555">1. Incluir el SDK</h3>
          <pre>&lt;script src="https://checkout.avoqado.io/sdk/avoqado.js"&gt;&lt;/script&gt;</pre>

          <h3 style="margin-top: 20px; color: #555">2. Inicializar el Checkout</h3>
          <pre>
const checkout = new AvoqadoCheckout({
  sessionId: 'cs_avoqado_xxxxx',  // ‚Üê Obtenido de tu backend
  amount: 100.00,
  currency: 'MXN',
  locale: 'es-MX',

  // Callbacks
  onSuccess: (result) => {
    console.log('¬°Pago exitoso!', result);
    // result.sessionId
    // result.token
    // result.maskedPan (e.g., "4111 **** **** 1111")
    // result.cardBrand (e.g., "visa")

    // Redirigir a p√°gina de √©xito
    window.location.href = '/success?session_id=' + result.sessionId;
  },

  onError: (error) => {
    console.error('Error en el pago:', error);
    // error.message
    // error.code

    alert('Error: ' + error.message);
  },

  onCancel: () => {
    console.log('Pago cancelado por el usuario');
  }
});

// Montar el checkout en el DOM
checkout.mount('#payment-container');</pre
          >

          <h3 style="margin-top: 20px; color: #555">3. Flujo Completo (Backend + Frontend)</h3>
          <pre>
// BACKEND: Crear sesi√≥n de checkout
const session = await fetch('/api/v1/sdk/checkout/sessions', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'X-API-Key': 'tu_api_key_avoqado'
  },
  body: JSON.stringify({
    amount: 100.00,
    currency: 'MXN',
    description: 'Orden #12345',
    customerEmail: 'cliente@ejemplo.com'
  })
});

const { sessionId } = await session.json();

// FRONTEND: Inicializar checkout con sessionId
const checkout = new AvoqadoCheckout({
  sessionId: sessionId,
  amount: 100.00,
  currency: 'MXN',
  onSuccess: (result) => {
    // Tokenizaci√≥n exitosa
    // Ahora procesar el cargo con /sdk/charge
  }
});

checkout.mount('#payment-container');</pre
          >

          <h3 style="margin-top: 20px; color: #555">4. API Methods</h3>
          <pre>
// Actualizar monto din√°micamente
checkout.updateAmount(150.00);

// Destruir el checkout
checkout.unmount();

// Verificar si est√° montado
if (checkout.isMounted()) {
  console.log('Checkout activo');
}</pre
          >
        </div>
      </div>

      <!-- Security Info -->
      <div class="demo-section">
        <div class="card">
          <h2>üîí Seguridad (SAQ A)</h2>
          <ul style="line-height: 1.8; color: #555">
            <li>‚úÖ Los datos de tarjeta <strong>NUNCA</strong> se almacenan en tu servidor</li>
            <li>‚úÖ Tokenizaci√≥n inmediata con Blumon (PCI compliant)</li>
            <li>‚úÖ Logs autom√°ticamente filtran PAN/CVV</li>
            <li>‚úÖ Content Security Policy (CSP) implementada</li>
            <li>‚úÖ Rate limiting: 10 requests/minuto</li>
            <li>‚úÖ Iframe aislado con sandbox</li>
          </ul>
        </div>

        <div class="card">
          <h2>üìä Caracter√≠sticas</h2>
          <ul style="line-height: 1.8; color: #555">
            <li>üé® UI hermosa tipo Stripe</li>
            <li>üîÑ Validaci√≥n en tiempo real (Luhn algorithm)</li>
            <li>üí≥ Detecci√≥n autom√°tica de marca (Visa/MC/Amex)</li>
            <li>üì± Responsive (mobile + desktop)</li>
            <li>üåç Multi-idioma (es-MX, en-US)</li>
            <li>‚ö° Comunicaci√≥n v√≠a postMessage</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Include the SDK -->
    <script src="/sdk/avoqado.js"></script>

    <!-- Demo Logic (external file to comply with CSP) -->
    <script src="/sdk/example.js"></script>
  </body>
</html>

# Railway Deployment Guide

## ğŸš€ **Deployment Overview**

Your Avoqado Server is now **Docker-ready** and optimized for Railway deployment.

## ğŸ“‹ **Pre-Deployment Checklist**

âœ… Docker build working correctly  
âœ… Multi-stage Dockerfile with security best practices  
âœ… Railway configuration created (`railway.toml`)  
âœ… Health check endpoint implemented

## ğŸ›  **Railway Services Setup**

### **1. Database (PostgreSQL)**

```bash
# Create PostgreSQL service in Railway
railway add postgresql
```

### **2. Redis Cache**

```bash
# Create Redis service in Railway
railway add redis
```

### **3. RabbitMQ Options**

âš ï¸ **Important**: Railway doesn't offer managed RabbitMQ. Choose one option:

#### **Option A: CloudAMQP (Recommended)**

1. Sign up at [CloudAMQP](https://cloudamqp.com)
2. Create a free "Little Lemur" plan instance
3. Get connection URL: `amqps://username:password@host/vhost`

#### **Option B: Replace with Redis Pub/Sub**

- Modify codebase to use Redis instead of RabbitMQ
- Requires code changes in `/src/communication/` directory

## ğŸ” **Environment Variables**

Set these in Railway Dashboard â†’ Variables:

```bash
# Database
DATABASE_URL=<auto-generated-by-railway-postgres>

# Redis
REDIS_URL=<auto-generated-by-railway-redis>

# RabbitMQ (CloudAMQP)
RABBITMQ_URL=amqps://username:password@host/vhost

# Authentication (Generate secure values)
JWT_SECRET=<your-secure-jwt-secret-256-bits>
SESSION_SECRET=<your-secure-session-secret>

# Application
NODE_ENV=production
PORT=3000

# Logging
LOG_LEVEL=info
```

## ğŸš€ **Deployment Steps**

### **Step 1: Initialize Railway Project**

```bash
# Install Railway CLI
npm install -g @railway/cli

# Login to Railway
railway login

# Initialize project
railway init
```

### **Step 2: Add Services**

```bash
# Add PostgreSQL
railway add postgresql

# Add Redis
railway add redis
```

### **Step 3: Set Environment Variables**

```bash
# Set JWT secret (generate a secure 256-bit key)
railway variables set JWT_SECRET="your-super-secure-jwt-secret-here"

# Set session secret
railway variables set SESSION_SECRET="your-super-secure-session-secret-here"

# Set RabbitMQ URL (from CloudAMQP)
railway variables set RABBITMQ_URL="amqps://username:password@host/vhost"

# Set log level
railway variables set LOG_LEVEL="info"
```

### **Step 4: Deploy**

```bash
# Deploy the application
railway up
```

## ğŸ¥ **Health Check**

The application includes a health check endpoint:

- **URL**: `/health`
- **Method**: GET
- **Response**: `200 OK` when healthy

## ğŸ” **Post-Deployment Verification**

1. **Check Logs**: `railway logs`
2. **Verify Services**: Ensure PostgreSQL, Redis, and app are running
3. **Test Endpoints**: Verify API endpoints respond correctly
4. **Monitor Performance**: Check Railway metrics dashboard

## ğŸ›¡ **Security Features**

âœ… Non-root user in Docker container  
âœ… Multi-stage build (smaller attack surface)  
âœ… Health checks for container monitoring  
âœ… Proper signal handling with `dumb-init`  
âœ… Environment-based configuration

## ğŸ¯ **Domain & Custom URL**

After deployment:

1. Go to Railway Dashboard
2. Click on your service
3. Go to "Settings" â†’ "Domains"
4. Add your custom domain or use Railway's provided URL

## ğŸ“Š **Monitoring & Logs**

```bash
# View logs
railway logs

# Follow logs in real-time
railway logs --follow

# Check service status
railway status
```

## ğŸ”„ **Updates & Redeployment**

```bash
# Redeploy after changes
git add .
git commit -m "Update application"
git push
railway up
```

## ğŸ†˜ **Troubleshooting**

### Common Issues:

1. **Database Connection**: Ensure `DATABASE_URL` is set correctly
2. **Redis Connection**: Verify `REDIS_URL` from Railway Redis service
3. **RabbitMQ**: Confirm CloudAMQP URL format and credentials
4. **Port Issues**: Railway automatically sets PORT=3000, don't override
5. **Health Check**: Ensure `/health` endpoint returns 200 status

### Debug Commands:

```bash
# Check environment variables
railway variables

# View service information
railway service

# Check build logs
railway logs --build
```
